/*
* DO NOT EDIT
*
* {{ .Info.Title }}
* Version: {{ .Info.Version }}
*
* Generated by https://github.com/oasgo/oasgo
*/

package client

{{ $cName :=  (printf "HTTP%sClient" (goName .Info.Title false) ) }}
{{ $iName := (printf (goName .Info.Title false)) }}

var _ {{ $iName }} = new({{ $cName }})

type {{ $iName}} interface {
	{{- range $_, $p := .Paths -}}
		{{- range $m, $op := $p.GetMethodsMap }}
			{{ template "signature" $op -}}
		{{- end -}}
	{{- end}}
}

type {{ $cName }} struct {
	URL *url.URL
  HTTP *http.Client
}

{{ range $_, $schema := .Components.Schemas }}
	{{- $schema.RenderDefinition }}
{{ end }}

func New{{ $cName }} (host string) (*{{ $cName }}, error) {
	u, err := url.Parse(host)
	if err != nil {
		return nil, err
	}
	return &{{$cName}}{
		URL: u,
    HTTP: &http.Client{},
	}, nil
}

{{ range $u, $p := .Paths -}}
	{{ range $m, $op := $p.GetMethodsMap }}
// {{ goName .OperationID false }} {{ $op.Description }}
func (c {{ $cName }}) {{- template "signature" $op -}}{
	u := *c.URL
  u.Path = "{{- $u -}}"

  {{if $op.Parameters}}
    u.Path = strings.NewReplacer(
    {{- range $i, $arg := $op.Parameters}}
      {{- if eq $arg.In "path"}}
				{{- if not $arg.Required }}
					if {{- $arg.Name}} != nil {
				{{- end  }}
        "{{"{"}}{{- $arg.Name}}{{"}"}}", {{$arg.RenderAsString}},
				{{- if not $arg.Required }}
					}
				{{- end  }}
      {{- end }}
    {{- end }}
    ).Replace(u.Path)

    q := u.Query()
    {{- range $i, $arg := $op.Parameters}}
      {{- if eq $arg.In "query" }}
				{{- if not $arg.Required }}
					if {{ $arg.Name}} != nil {
				{{- end  }}
        q.Set("{{- $arg.Name}}", {{- $arg.RenderAsString}})
				{{ if not $arg.Required -}}
					}
				{{- end  }}
      {{- end }}
    {{- end }}
    u.RawQuery = q.Encode()
  {{end}}

	request, err := http.NewRequest("{{$m}}", u.String(), nil)
	if err != nil {
		return nil, err
	}

	resp, err := c.HTTP.Do(request)
	if err != nil {
		return nil, err
	}
	defer resp.Body.Close()

  if r, ok := res.(*string); ok {
    body, err := ioutil.ReadAll(resp.Body)

    if err != nil {
      return resp, err
    }

    *r = string(body)
    return resp, nil
  }

	if err = json.NewDecoder(resp.Body).Decode(res); err != nil {
    return resp, err
  }

  return resp, nil
}
	{{ end }}
{{- end }}
